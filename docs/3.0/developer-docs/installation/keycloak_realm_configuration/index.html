



<!DOCTYPE html>
<html>
	<head>
	<base id="baseURL" href="/" />
<script>
	// Dynamic Base URL
	function getBase(){
		excludedSites = ["127.0.0.1:4000", "www.sunbird.org", "lakhanmandloi.github.io"];
		baseURL = document.getElementById('baseURL');
		if (excludedSites.indexOf(window.location.host) > -1){
			baseURL.href="/";
		} else {
			baseURL.href="/releases/release-1.0.20/";
		}
	}
	getBase();
</script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=10, user-scalable=yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-touch-fullscreen" content="yes" />
<link rel="icon" type="image/png" href="img/favicon/favicon-16x16.png" sizes="16x16">
<meta name="msapplication-TileColor" content="#65d3f7">
<meta name="msapplication-TileImage" content="img/favicon/mstile-150x150.png">

<title>Sunbird Configure Keycloak</title>
<meta name="description" content="Sunbird Site Keycloak configuration"/>

<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="pragma" content="no-cache" />
<meta name="last-modified" content="2018-01-02 12:24:48 +0530">
<meta http-equiv="Expires" content="600" />

<!--Build Details-->
<meta name="buildVersion" content="release-1.0.20" />
<meta name="buildNo" content="376" />
<!--/Build Details-->

<!-- CDN's-->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,600,700" >
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" >
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<!-- /CDN's-->

<link rel="stylesheet" href="css/owl/owl.carousel.min.css?02012018"  />
<link rel="stylesheet" href="css/style.css?02012018"  />
<script type="text/javascript" src="js/bootstrap.min.js?02012018"></script>
<script type="text/javascript" src="js/owl.carousel.min.js?02012018"></script>
<script type="text/javascript" src="js/jquery.tocLight.js?02012018"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106552125-1"></script>

	
		<meta name="robots" content="index, follow">
	 
  </head>
  <body id="body">
  <div class="container inner container-height docs 3.0 latest">
    <header class="logo-container">
      <div class="logo">
        <a href="index.html">
          <img src="img/sunbird-logo.png" alt="Sunbird docs" title="Sunbird docs">
        </a>
      </div>
      <button type="button" class="dropdown-toggle collapsed" id="dropdown-trigger" data-toggle="collapse" data-target="#mobile-dropdown" aria-expanded="false">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </button>
    </header>
    <nav class="sidebar-container" id="mobile-dropdown">
		<div class="inner__sidebar">
			
				<div class="search-cover">
	<form method="get" action="https://www.google.com/search" target="_blank">
		<input type="text" value="" name="q" placeholder="Search"/ class="search-input" title="Enter keyword to search">
		<input type="hidden" value="en" name="hl" />
		<input type="hidden" name="sitesearch" value="http://www.sunbird.org" />
		<input type="hidden" value="lang_en" name="lr" />
		<button type="submit" onclick="submit()" class="search-btn" title="Search">
			<i class="fa fa-search"></i>
		</button>
	</form>
</div>

			
			<select id="docs-version">
	
		
			
				<option value="/docs/3.0/developer-docs/installation/keycloak_realm_configuration/" selected=selected>
					Version 3.0
					
						( Latest )
					
					</option>
			
	
		
			
				<option value="/docs/2.0/developer-docs/installation/keycloak_realm_configuration/" >
					Version 2.0
					
					</option>
			
	
		
			
				<option value="/docs/1.0/developer-docs/installation/keycloak_realm_configuration/" >
					Version 1.0
					
					</option>
			
	
</select>

<script>
	$(function(){
		$('#docs-version').on('change', function () {
			var url = $(this).val(); // get selected value
				if (url) { // require a URL
					window.location = url; // redirect
				}
			return false;
		});
	});
</script>

			<div class="sidebar-wrapper  developer-docs">
				 
	<a href="docs/3.0/architecture/">
		<h4 class="sidebar-group-title">Architecture</h4>
	</a>
	<ul class="sidebar-group architecture">
		<li>
			<a href="docs/3.0/architecture/overview/">Overview</a>
		</li>
		<li>
			<a href="docs/3.0/architecture/design/">Design</a>
		</li>
				<li>
					<div class="">
						<a href="docs/3.0/architecture/views/elementryview/">Views</a>
						<ul class="sidebar-group">
							<li>
								<a href="docs/3.0/architecture/views/logical/">Logical View</a>
							</li>
							<li>
								<a href="docs/3.0/architecture/views/physical/">Physical View</a>
							</li>
							<li>
								<a href="docs/3.0/architecture/views/conceptual/">Conceptual View</a>
							</li>
							<li>
								<a href="docs/3.0/architecture/views/deployment/">Deployment View</a>
							</li>
						</ul>
					</div>
				</li>
				<li>
					<a href="docs/3.0/architecture/usecase/">Use Cases</a>
				</li>
			</ul>
			<a href="docs/3.0/features-documentation/">
				<h4 class="sidebar-group-title">Product Features</h4>
			</a>
			<ul class="sidebar-group features-documentation" >
				<li>
					<a href="docs/3.0/features-documentation/onboarding/">Onboarding</a>
				</li>
				<li>
					<a href="docs/3.0/features-documentation/login/">Login</a>
				</li>
				<li>
					<a href="docs/3.0/features-documentation/register_org/">Register Organizations</a>
				</li>
				<li>
					<a href="docs/3.0/features-documentation/register_user/">Register Users</a>
				</li>
				<li>
					<a href="docs/3.0/features-documentation/userrolepermission/">User Roles and Permissions</a>
				</li>
				<li>
					<div class="">
						<ul class="sidebar-group">
							<li>
								<a href="docs/3.0/features-documentation/userprofile/">User Profile</a>
							</li>
							<li>
								<a href="docs/3.0/features-documentation/workspace/">Workspace</a>
							</li>
						</ul>
					</div>
				</li>
				<li>
					<a href="docs/3.0/features-documentation/coursetraining/">Courses and Training</a>
				</li>
				<li>
					<a href="docs/3.0/features-documentation/library/">Library</a>
				</li>
				<li>
					<a href="docs/3.0/features-documentation/contentlifecycle/">Content Lifecycle</a>
				</li>
				<li>
					<a href="docs/3.0/features-documentation/contentcreation/">Content Creation</a>
				</li>
				<li>
					<a href="docs/3.0/features-documentation/contenteditor/">Content Editor</a>
				</li>
				<!--<li>
					<a href="features-documentation/consumption/">Consume Study Material</a>
				</li>-->
				</li>
				<li>
					<div class="">
						<a href="docs/3.0/features-documentation/guidelines/" >Guidelines</a>
						<ul class="sidebar-group">
							<li>
								<a href="docs/3.0/features-documentation/intellectualproperty/">Intellectual Property</a>
							</li>
						</ul>
					</div>
				</li>
				<!--<li>
					<a href="features-documentation/reportinganalytics/">Reporting and Analytics</a>
				</li>-->
				<li>
					<a href="docs/3.0/features-documentation/collaborationpartnership/">Collaboration and Partnership</a>
				</li>
		</ul>
		<a href="docs/3.0/developer-docs/">
				<h4 class="sidebar-group-title">Developer Documentation</h4>
			</a>
		<ul class="sidebar-group developer-docs">
					<li>
						<a href="docs/3.0/developer-docs/installation/">Installation Overview</a>
					</li>
					<!--<li>
						<a href="developer-docs/hosting_sunbird/">Hosting Sunbird</a>
					</li>-->
					<li>
						<a  href="docs/3.0/developer-docs/installation/installing_sunbirdon_laptop/">Install Sunbird on Laptop</a>
					</li>
					<li>
						<div class="">
							<a href="docs/3.0/developer-docs/installation/medium_scale_deploy/">Medium Scale Deployment</a>
							<ul class="sidebar-group">
								<li>
									<a href="docs/3.0/developer-docs/installation/provisioning_servers/">Provisioning Servers</a>
								</li>
								<li>
									<a href="docs/3.0/developer-docs/installation/setup_db/">Setup Databases</a>
								</li>
								<li>
									<a href="docs/3.0/developer-docs/installation/deploy_sb_services/">Deploying Sunbird Services</a>
								</li>
								<li>
									<a href="docs/3.0/developer-docs/installation/keycloak_realm_configuration/">Configure Keycloak</a>
								</li>
								<li>
									<a href="docs/3.0/developer-docs/installation/cust_sunbird/">Customizing Assets</a>
								</li>
								<li>
									<a href="docs/3.0/developer-docs/installation/check_installation/">Check Installation</a>
								</li>
								<!--<li>
									<a href="developer-docs/installation/keycloak_sms_authenticator/">Authentication</a>
								</li>-->
							</ul>
						</div>
					</li>
					<li>
						<a href="docs/3.0/developer-docs/installation/install_mobile_setup/">Mobile App Installation</a>
					</li>
					<!--<li>
						<div class="">
							<a class="sidebar-group-title" href="developer-docs/extending_sunbird/">Extending Sunbird</a>
						</div>
					</li>
					<li>
						<div class="">
							<a class="sidebar-group-title" href="developer-docs/customize_sunbird/">Customizing Sunbird</a>
						</div>
					</li>-->
					<li>
						<div class="">
							<a  href="docs/3.0/apis/">API References</a>
							<ul class="sidebar-group">
								<li>
									<a href="apis/bulkupload/" target="_blank">Bulk Upload Service APIs</a>
								</li>
								<li>
									<a href="apis/content/" target="_blank">Content APIs</a>
								</li>
								<li>
									<a href="apis/coursebatchmanapi/" target="_blank">Course Batch Management APIs</a>
								</li>
								<li>
									<a href="apis/datasyncapi/" target="_blank">Data Sync APIs</a>
								</li>
								<li>
									<a href="apis/metricsapi/" target="_blank">Metrics APIs</a>
								</li>
								<li>
									<a href="apis/notificationapi/" target="_blank">Notification APIs</a>
								</li>
								<li>
									<a href="apis/orgapi/" target="_blank">Organisation Management APIs</a>
								</li>
								<li>
									<a href="apis/userapi/" target="_blank">User APIs</a>
								</li>
							</ul>
						</div>
					</li>
					<li>
						<a href="docs/3.0/developer-docs/troubleshooting/">Troubleshooting</a>
					</li>
			</li>
		</ul>
		<a href="docs/3.0/faqs/">
			<h4 class="sidebar-group-title">Frequently asked questions</h4>
		</a>
		<ul class="sidebar-group faqs" >
			<li>
				<a href="docs/3.0/faqs/audience/">Audience</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/content_format/">Content Format</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/content_repo/">Content Repositories</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/contentreviews/">Content Review</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/content_types/">Content Types</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/content_upload/">Content Upload</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/feature/">Features</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/fixerrors/">Fix Errors</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/helpsupport/">Help Support</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/intellectual_propertylicensesstandards/">Intellectual Property Licenses Standards</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/registrationenrolment/">Registration and Enrollment</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/signin/">Sign In</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/taxonomymetadataframework/">Taxonomy Meta Data Framework</a>
			</li>
			<li>
				<a href="docs/3.0/faqs/user_rightspermissions/">Users Rights and Permission</a>
			</li>
		</ul>
		<a href="docs/3.0/glossary/">
			<h4 class="sidebar-group-title">Glossary</h4>
		</a>
	

			</div>
			<script>
				$("a[href$='docs/3.0/developer-docs/installation/keycloak_realm_configuration/']").addClass("sidebar-link-selected");
			</script>
		</div>
    </nav>
    <div class="content">
      <div class="inner__content header" id="heading">
        <h1>Configure Keycloak </h1>
      </div>

      <div id="main-content" class="inner__content">
			<p class="edit-para text-right">
				<span>
			<a target="_blank" class="contribute" href="docs/contributions/contribution_guidelines">
				  <i class="fa fa-book" aria-hidden="true"></i> <i>Contribution Guidelines</i>
			  </a> &nbsp;&nbsp;
			  
			 <a target="_blank"  title="Edit this page"class="" href="https://github.com/lakhanmandloi/lakhanmandloi.github.io/edit/dev/docs/3.0/developer-docs/installation/keycloak_realm_configuration.md">
				  <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit
			  </a> 
			  | 
			  <a target="_blank" href="https://github.com/lakhanmandloi/lakhanmandloi.github.io/issues" title="Report issue">
				  <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
				  Report
			  </a>
			  </span>
			</p>
          <div id="toc-container">
  <table class="toc" id="toc">
    <tbody>
      <tr>
        <td>
          <div id="toctitle">
            <h2>Contents</h2>
            <span class="toctoggle">[<a id="toctogglelink" class="internal" href="#">hide</a>]</span>
          </div>
          <ul>
            <li class="toc_level-1 toc_section-1">
              <a href="#getting-started"><span class="tocnumber">1 .</span> <span class="toctext">Getting Started</span></a>
              <ul>
                <li class="toc_level-2 toc_section-2">
                  <a href="#access-keycloak"><span class="tocnumber">1.1 .</span> <span class="toctext">Access Keycloak</span></a>
                </li>
                <li class="toc_level-2 toc_section-3">
                  <a href="#setting-the-admin-password"><span class="tocnumber">1.2 .</span> <span class="toctext">Setting the Admin password</span></a>
                </li>
                <li class="toc_level-2 toc_section-4">
                  <a href="#import-realm"><span class="tocnumber">1.3 .</span> <span class="toctext">Import Realm</span></a>
                </li>
                <li class="toc_level-2 toc_section-5">
                  <a href="#smtp-configuration"><span class="tocnumber">1.4 .</span> <span class="toctext">SMTP Configuration</span></a>
                </li>
                <li class="toc_level-2 toc_section-6">
                  <a href="#create-a-user-who-can-access-the-user-management-api"><span class="tocnumber">1.5 .</span> <span class="toctext">Create a user who can access the user management API</span></a>
                </li>
                <li class="toc_level-2 toc_section-7">
                  <a href="#update-client--secrets"><span class="tocnumber">1.6 .</span> <span class="toctext">Update Client &amp; Secrets</span></a>
                </li>
              </ul>
            </li>
          </ul>
        </td>
      </tr>
    </tbody>
  </table>
</div><h2 id="getting-started">Getting Started</h2>

<p>A step by step guide to run and provision the keycloak server locally is explained in detail <a href="http://www.keycloak.org/docs/latest/getting_started/index.html" target="_blank">here</a>.
The Sunbird uses Keycloak as the identity and authentication provider.</p>

<h3 id="access-keycloak">Access Keycloak</h3>

<p>Once the sunbird services are set up, <a href="https://sunbird.example.com/auth/admin" target="_blank">visit</a> (Assuming you’ve set up sunbird on sunbird.example.com) to access the Keycloak administration.</p>

<h3 id="setting-the-admin-password">Setting the Admin password</h3>

<ul>
  <li>Log into the docker container running keycloak by executing the following commands:</li>
</ul>

<pre>
#Find where the container is running
docker service ps keycloak1
#If you are running all services on single server no need to SSH
#If you are in a different server, SSH into node running keycloak
ssh {node-running-keycloak-container}
#Find the keycloak container ID
docker ps | grep keycloak
#Login to container
docker exec -uroot -it {container-ID}
</pre>

<ul>
  <li>Change to the path to keycloak root directory (most likely <code>/opt/jboss/keycloak</code>)</li>
  <li>Execute the following script to set the administrator user name and password</li>
</ul>

<p>
  <code>
$ ./bin/add-user-keycloak.sh -u &lt;admin&gt; -p &lt;yourpassword&gt;
</code>
</p>

<p>The script will execute creating admin user and password.</p>

<ul>
  <li>You can now log into the administration console using these credentials.</li>
</ul>

<p>Once you view the administration console,clients and the secrets can be set by following steps:</p>

<h3 id="import-realm">Import Realm</h3>

<p>To simplify the configuration, Sunbird provides a ready to use realm that can be readily imported and used. Download the realm <a href="docs/developer-docs/installation/other_files/keycloak-realm" target="_blank">here</a>.</p>

<p>To import the realm, use the ‘Add realm’ button, refer to the following images to get more clarity.</p>

<p>
  <a target="_blank" href="pages/developer-docs/installation/images/keycloack-add-realm.png">
        <img src="pages/developer-docs/installation/images/keycloack-add-realm.png" alt="Keycloak realm" class="plugin center" width="50%" />
      </a>
</p>

<p>
  <a target="_blank" href="pages/developer-docs/installation/images/keycloak-choose-json.png">
        <img src="pages/developer-docs/installation/images/keycloak-choose-json.png" alt="choose keycloak json" class="plugin center" width="50%" />
      </a>
</p>

<p>On the import screen, choose the json file and then click ‘Create’.</p>

<p>
  <a target="_blank" href="pages/developer-docs/installation/images/keycloak-import-realm.png">
        <img src="pages/developer-docs/installation/images/keycloak-import-realm.png" alt="Keycloak import realm" class="plugin center" width="50%" />
      </a>
</p>

<p>Once the realm is imported ensure the realm is set as active realm before proceeding with the rest of the configuration</p>

<h3 id="smtp-configuration">SMTP Configuration</h3>

<p>Email configuration is needed to ensure password reset and user management flows work smoothly. Navigate to <code>Realm Settings &gt; Email</code>. Fill up the SMTP credentials and use the Test Connection button to verify the SMTP connection is working.</p>

<h3 id="create-a-user-who-can-access-the-user-management-api">Create a user who can access the user management API</h3>

<p>Navigate to Manage &gt; Users and create a new user. Put the username as <code>user-manager</code>, set the email to be verified and save. After saving, assign a password to this user.</p>

<p>Next update the client roles under role mappings to ensure that this user has the <code>manage-users</code>, <code>query-users</code>, <code>query-groups</code> and <code>view-users</code> roles.The screenshot below gives a view of reference configuration.</p>

<p>
  <a target="_blank" href="pages/developer-docs/installation/images/keycloak-add-user-manager.png">
        <img src="pages/developer-docs/installation/images/keycloak-add-user-manager.png" alt="Keycloak use management" class="plugin center" width="50%" />
      </a>
</p>

<p>Use corresponding username and password values for this user as the values for <code>sunbird_sso_username</code> and <code>sunbird_sso_password</code> in the configuration.</p>

<h3 id="update-client--secrets">Update Client &amp; Secrets</h3>

<p>Navigate to <code>Clients</code> and make the changes listed below to each of the clients. Only change the clients listed below. Settings for other clients need not be changed.</p>

<h4 id="account-broker-realm-management">Account, broker, realm-management</h4>

<p>Go to the <code>Credentials</code> tab and regenerate the Secret and Registration Access Token. Note both, you will need them in a later step.</p>

<h4 id="android">Android</h4>

<p>Change the Root URL to <code>https://sunbird.example.com</code>
Add a Valid Redirect URI <code>https://sunbird.example.com/oauth2callback</code></p>

<h4 id="portal">Portal</h4>

<p>Change the Root URL to <code>https://sunbird.example.com</code>
Add Valid Redirect URIs <code>https://sunbird.example.com/private/*</code> and <code>https://sunbird.example.com/</code></p>

<h4 id="trampoline">Trampoline</h4>

<p>Change the Root URL to <code>https://sunbird.example.com</code>
Go to the Credentials tab and regenerate the Secret and Registration Access Token. Use the secret as the value for the <code>sunbird_trampoline_secret</code> configuration.</p>

          
          <hr />
          
          <p class="edit-para text-right">
			<a target="_blank" href="https://github.com/lakhanmandloi/lakhanmandloi.github.io/edit/dev/docs/3.0/developer-docs/installation/keycloak_realm_configuration.md" title="Fix this page">
				<i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit</a> |
			<a target="_blank" href="https://github.com/lakhanmandloi/lakhanmandloi.github.io/issues" title="Report issue">
				<i class="fa fa-exclamation-circle" aria-hidden="true"></i> Report</a>
		  </p>
		  <a href="docs/3.0/developer-docs/installation/keycloak_realm_configuration/#heading" class="scrollup"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></a>
          
      </div>
    </div>
    <div class="page-footer">
		<footer class="footer">
	<div class="footer__top">
		<div class="container">
			<div class="row">
				
			<div class="col-md-4 col-sm-12">
			</div>
			
			<div class="col-md-2 col-sm-6 ">
				<ul>
					<li><a href="about/">About Sunbird</a></li>
					<li><a href="contact/">Contact Us</a></li>
					<li><a href="privacy-policy/">Privacy Policy</a></li>
				</ul>
			</div>
			
			<div class="col-md-2 col-sm-6 sideline">
				<ul>
					<li><a href="docs/">Documentation</a></li>
					<li><a href="features/">Features</a></li>
				</ul>
			</div>

			<div class="col-md-2 col-sm-12">
			</div>
			
		</div>
	</div>
</footer>

	</div>
  </div>
  <script type="text/javascript">
	//TOC Toggle
    $(function() {
        $.toc.clickHideButton();
    });
    //Scroll to top
    $(document).ready(function () {
		$(".content").scroll(function () {
			if ($(this).scrollTop() > 250) {
				$('.scrollup').fadeIn();
			} else {
				$('.scrollup').fadeOut();
			}
		});
	});
	$('#toc a').each(function(){
		var url = this.href.replace(baseURL.href, "");
		this.href = 'docs/3.0/developer-docs/installation/keycloak_realm_configuration/' + url;
    })
  </script>
  </body>
</html>
